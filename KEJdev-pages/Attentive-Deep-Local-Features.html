<!DOCTYPE html>
<html>
<head>
    
    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Large-Scale Image Retrieval with Attentive Deep Local Features</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    
        <script type="text/x-mathjax-config">
MathJax.Hub.Config({
    TeX: {
      equationNumbers: {
        autoNumber: "AMS"
      }
    },
    tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$'] ],
    processEscapes: true,
  }
});
MathJax.Hub.Register.MessageHook("Math Processing Error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
MathJax.Hub.Register.MessageHook("TeX Jax - parse error",function (message) {
	  alert("Math Processing Error: "+message[1]);
	});
</script>
<script type="text/javascript" async
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
    
    <script data-ad-client="ca-pub-5107584879184113" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->
    
    <!-- This tag outputs SEO meta+structured data and other important settings -->
    <meta name="description" content="If i was rich, i would eat tteokbokki every day." />
    <link rel="shortcut icon" href="https://KEJdev.github.io/./assets/images/favicon.png" type="image/png" />
    <link rel="canonical" href="https://KEJdev.github.io/Attentive-Deep-Local-Features" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

     <!--title below is coming from _includes/dynamic_title-->
    <meta property="og:site_name" content="덕복희" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Large-Scale Image Retrieval with Attentive Deep Local Features" />
    <meta property="og:description" content="Large-Scale Image Retrieval with Attentive Deep Local Features Paper URL: https://arxiv.org/pdf/1612.06321.pdf 이 논문은 CNN 계열의 DELF 라고 부르는 모델을 설명하는 논문입니다. CNN( Convolutional Neural Network ) 모델이 무엇인지는 설명을 안해도 아시죠? 혹시 모르니, 나중에 CNN 모델을 더 자세하게 따로 다루겠습니다. CNN은 이미지 연구 분야에서 대단한 성과를 이뤘지만 CNN의 단점이 의외로" />
    <meta property="og:url" content="https://KEJdev.github.io/Attentive-Deep-Local-Features" />
    <meta property="og:image" content="https://KEJdev.github.io/../assets/images/paper_cover1.png" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta property="article:author" content="https://www.facebook.com/" />
    <meta property="article:published_time" content="2018-01-17T19:00:00+09:00" />
    <meta property="article:modified_time" content="2018-01-17T19:00:00+09:00" />
    <meta property="article:tag" content="Paper" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Large-Scale Image Retrieval with Attentive Deep Local Features" />
    <meta name="twitter:description" content="Large-Scale Image Retrieval with Attentive Deep Local Features Paper URL: https://arxiv.org/pdf/1612.06321.pdf 이 논문은 CNN 계열의 DELF 라고 부르는 모델을 설명하는 논문입니다. CNN( Convolutional Neural Network ) 모델이 무엇인지는 설명을 안해도 아시죠? 혹시 모르니, 나중에 CNN 모델을 더 자세하게 따로 다루겠습니다. CNN은 이미지 연구 분야에서 대단한 성과를 이뤘지만 CNN의 단점이 의외로" />
    <meta name="twitter:url" content="https://KEJdev.github.io/" />
    <meta name="twitter:image" content="https://KEJdev.github.io/../assets/images/paper_cover1.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="덕복희" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Paper" />
    <meta name="twitter:site" content="@" />
    <meta name="twitter:creator" content="@" />
    <meta property="og:image:width" content="1400" />
    <meta property="og:image:height" content="933" />

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "덕복희",
        "logo": "https://KEJdev.github.io/./assets/images/blog-icon.png"
    },
    "url": "https://KEJdev.github.io/Attentive-Deep-Local-Features",
    "image": {
        "@type": "ImageObject",
        "url": "https://KEJdev.github.io/../assets/images/paper_cover1.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://KEJdev.github.io/Attentive-Deep-Local-Features"
    },
    "description": "Large-Scale Image Retrieval with Attentive Deep Local Features Paper URL: https://arxiv.org/pdf/1612.06321.pdf 이 논문은 CNN 계열의 DELF 라고 부르는 모델을 설명하는 논문입니다. CNN( Convolutional Neural Network ) 모델이 무엇인지는 설명을 안해도 아시죠? 혹시 모르니, 나중에 CNN 모델을 더 자세하게 따로 다루겠습니다. CNN은 이미지 연구 분야에서 대단한 성과를 이뤘지만 CNN의 단점이 의외로"
}
    </script>
    
    <!-- <script type="text/javascript" src="https://demo.ghost.io/public/ghost-sdk.min.js?v=724281a32e"></script>
    <script type="text/javascript">
    ghost.init({
    	clientId: "ghost-frontend",
    	clientSecret: "f84a07a72b17"
    });
    </script> -->

    <meta name="generator" content="Jekyll 3.6.2" />
    <link rel="alternate" type="application/rss+xml" title="Large-Scale Image Retrieval with Attentive Deep Local Features" href="/feed.xml" />


</head>
<body class="post-template">

    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->

<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    
    <div class="site-nav-right">
        
            <ul class="nav" role="menu">
    <li class="nav-HOME" role="menuitem"><a href="/">HOME</a></li>
    <li class="nav-SQL" role="menuitem"><a href="/tag/sql/">SQL</a></li>
    <li class="nav-PLSQL" role="menuitem"><a href="/tag/plsql/">PLSQL</a></li>
    <li class="nav-R" role="menuitem"><a href="/tag/r/">R</a></li>
    <li class="nav-PYTHON" role="menuitem"><a href="/tag/python/">PYTHON</a></li>
    <li class="nav-MACHINE-LEARNING" role="menuitem"><a href="/tag/machine-learning/">MACHINE-LEARNING</a></li>
    <li class="nav-PAPER" role="menuitem"><a href="/tag/paper/">PAPER</a></li>
    <li class="nav-ALGORITHM" role="menuitem"><a href="/tag/algorithm/">ALGORITHM</a></li>     
</ul>

        
    </div>
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-paper ">

            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="17 January 2018">17 January 2018</time>
                    
                        <span class="date-divider">/</span>
                        
                            
                               <a href='/tag/paper/'>PAPER</a>
                            
                        
                    
                </section>
                <h1 class="post-full-title">Large-Scale Image Retrieval with Attentive Deep Local Features</h1>
            </header>

            
            <figure class="post-full-image" style="background-image: url(/../assets/images/paper_cover1.png)">
            </figure>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <h3 id="large-scale-image-retrieval-with-attentive-deep-local-features">Large-Scale Image Retrieval with Attentive Deep Local Features</h3>
<p>Paper URL: https://arxiv.org/pdf/1612.06321.pdf</p>

<p>이 논문은 CNN 계열의 DELF 라고 부르는 모델을 설명하는 논문입니다.<br />
CNN( Convolutional Neural Network ) 모델이 무엇인지는 설명을 안해도 아시죠?<br />
혹시 모르니, 나중에 CNN 모델을 더 자세하게 따로 다루겠습니다.</p>

<p>CNN은 이미지 연구 분야에서 대단한 성과를 이뤘지만 CNN의 단점이 의외로 많답니다. <br />
혹시 대규모의 이미지 검색 시스템에서는 성능이 무척이나 떨어진다는 것을 아시나요?</p>

<p>실제로 CNN을 이용하여 방대한 이미지를 검색하는 시스템에서는 거의 사용하기 힘들다고 합니다. 그렇다면 CNN을 이용해서 방대한 이미지를 검색하려면 어떻게 해야댈까요 ?</p>

<hr />

<blockquote>
  <h4 id="the-main-purpose-of-the-paper">The main purpose of the paper.</h4>
</blockquote>

<p>이 논문은 CNN을 활용한 대규모 이미지 검색 시스템을 만드는 것이 목적입니다.<br />
논문에서는 CNN기반의 DELF 라는 모델을 만들었습니다.</p>

<p>DELF모델은 아래의 그림과 같은 구조를 가지고 있습니다.</p>

<center><img src="/../assets/images/delf.png" width="850" height="500" /></center>

<p>모델의 구조에 대해서는 아래에서 천천히 알아볼께요.</p>

<hr />

<blockquote>
  <h4 id="dataset">Dataset</h4>
</blockquote>

<p>우선 논문에서 사용된 데이터는 구글에서 공개한 Landmark 데이터입니다.<br />
이 데이터는 정말 방대한 데이터이면서 여태까지 공개되어 있는 그 어떤 Landmark 데이터보다 좋은 데이터라고  알려져 있습니다.
요즘 캐글이나 Landmark 데이터에 관해 검색을 조금만 하셔도 금방 데이터를 찾아볼 수 있습니다.</p>

<p>데이터는 12,849개의 명소가 포함된 총 1,060,709개의 이미지와 111,036개의 Query 이미지가 들어있습니다. 
전세계를 대상으로 추출되었고, GPS정보와 연계되어 있습니다.</p>

<p>아래의 이미지는 데이터의 일부입니다.</p>

<center><img src="/../assets/images/(a)data.png" width="550" height="300" /></center>
<center><img src="/../assets/images/(b)data.png" width="550" height="300" /></center>
<center><img src="/../assets/images/(c)data.png" width="550" height="300" /></center>

<p><a href="https://en.wikipedia.org/wiki/Ground_truth">Ground Truth</a> 정보를 만들기 위해서 <strong>아래의 두가지 feature 정보를 활용</strong>했습니다. 
사실 정확한 Ground Truth를 만드는 것이 매우 어렵고 힘든 일입니다. 왜냐하면, GPS 정보가 잘못되어 있을 수 있고, Landmark 데이터가 너무 다양한 각도에서 촬영되어 서로 다른 구조물로 보일 수 있기 때문이예요. 그래서 실측 거리 25km 이내로 한정하여 구하면 적당히 좋은 결과를 얻을 수 있습니다.</p>

<ul>
  <li>Visual feature</li>
  <li>GPS coordinates</li>
</ul>

<p>위의 2개의 정보를 활용하여 클러스터를 구축하였고 Query 이미지와 클러스터 거리가 특정 threshold 이내로 들어오면 동일한 이미지라고 판단합니다.</p>

<hr />

<blockquote>
  <h4 id="delf-model">DELF Model</h4>
</blockquote>

<p>이제 DELF 모델에 대해 자세하게 설명하겠습니다.<br />
아래의 그림은 맨 처음에 보여드린 DELF의 전체적인 구조입니다. 
기억나시나요 ?</p>

<center><img src="/../assets/images/delf.png" width="850" height="500" /></center>

<p>DELF 모델의 기본적인 백본은 ResNet50입니다.<br />
ResNet50을 사용한 이유는 <a href="https://blog.naver.com/PostView.nhn?blogId=laonple&amp;logNo=220958109081&amp;proxyReferer=https%3A%2F%2Fwww.google.com%2F">FCN</a> 정보를 활용하기위해서 사용했으며, pretrain 된 net에서 conv4_x를 사용했습니다.</p>

<p>우선 논문에서는 image pyramid를 사용하여 여러개의 feature를 추출하였고, Landmark 데이터로 fine-tunnung 과정을 거칩니다. 
입력 이미지는 모두 center crop 한 뒤에 250x250으로 rescale 되는데, 여기서 또 244x244 크기로 랜덤 crop을 거칩니다.<br />
이 과정에서 object나 patch 레벨에서의 정보는 사용하지 않는다고 합니다.</p>

<center><img src="/../assets/images/models.png" width="700" height="500" /></center>

<p>추출된 feature를 모두 사용하는 것이 아니라 Attention을 이용해서 keypoint만 추출 한다고 합니다.
keypoint를 추출하는 이유는 시스템 효율화에도 매우 중요하며, 요즘 Attention을 이용해 신경망을 만드는 것이 트렌드이니, 혹시나 Attention을 모르신다면, 이 기회에 알아보는 것도 좋겠습니다.</p>

<hr />

<blockquote>
  <h4 id="learning">Learning</h4>
</blockquote>

<p>논문에서는 weighted sum을 이용한 방식을 사용했으며,</p>
<center>$$y=W(\sum _{ n } α(f_{ n };θ)⋅f_{ n })$$</center>

<p>여기서 $α(f_{ n };θ)$는 score 함수입니다.<br />
이때의 파라미터는 
이때의 파라미터는 $θ$가 되며 $W$는 $W∈R^{ Mxd }$ 이고 $M$는 클래스의 갯수입니다. Loss 는 cross entropy loss를 사용했습니다.</p>
<center>$$L=−y∗⋅log(\frac { exp(y) }{  1^{T}exp(y)})$$</center>

<p>여기서 $y*$는  ground-truth 이고 1 는 one vector입니다. 
실제 score는 2개의 conv 레이어와 softplus 비선형 함수로 구현되어 있으며, 더 자세한 설명은 논문을 참고하시길 바랍니다.</p>

<p>제안된 DELF 모델은 정말 간단하게 <strong>요약</strong>하자면, ature 와 attention 이 두가지가 모두 함게 학습되는 구조 입니다. 
그러나 이대로 학습을 한다면, 학습이 잘 안될 수 있어서 여기서는 2-step 학습 방식을 제안했습니다.</p>

<p>간단합니다.</p>

<ol>
  <li>먼저 descriptor 학습</li>
  <li>descriptor 를 고정하고 score-function 을 학습.</li>
</ol>

<p>최대한 성능을 올리기 위해 Attention 을 학습할 때 다양한 scale로 학습한다고 합니다. 
그래서 일단 center-crop을 수행하고 난 뒤 900x900 으로 rescale 합니다. 그리고 마지막으로 랜덤하게 720x720을 크롭한 뒤 r &lt;= 1 범위의 축적으로 최종 rescale 합니다.</p>

<p>또한 검색 성능을 올리기 위해 최종 dim 을 줄이는데, 먼저 L2 norm을 적용 후 PCA를 돌려 40dim까지 줄입니다. 그리고 다시 L2 norm 하면 끝이 납니다.</p>

<p>이 논문의 평가방법은 일반적으로 사용하는 mAP( mean average precision ) 에서 약간 바꿔서 사용했습니다. mAP는 모든 쿼리마다 얻어진 결과를 relevance 순으로 정렬한뒤 측정된 ap의 평균값을 의미합니다.</p>

<p>이 논문에서는 아래의 수식으로 바꾸어 평가하였습니다.</p>
<center>$$Pre=\frac { ∑_{ q }|R_{ q }^{ TP }| }{ ∑_{ _{ q } }|R_{ q }| } ,Rec=\sum _{ q } |R_{ q }^{ TP }|$$</center>

<p><br /><br />
$R_{ q }$는 쿼리 q로 얻어진 검색 결과를 의미하며, $R_{ q }^{ TP }$는 true-positive 를 의미합니다.<br />
아래의 표는 성능표입니다.  FT는 fine-tuning, ATT는 Attention 이라는 뜻입니다.</p>

<center><img src="/../assets/images/pred1.png" width="550" height="300" /></center>
<center><img src="/../assets/images/pred2.png" width="550" height="300" /></center>
<center><img src="/../assets/images/pred3.png" /></center>

<p><br /></p>

<p>표를 보면 좋은 성능의 모델이 무엇인지 잘 알겠죠 ?</p>

<hr />

<p>기본 CNN을 이용해서 Landmark 데이터 셋을 이용한다면, 좋은 정확도는 절대 뽑지 못할 거라 생각해요.</p>

<p>이 논문을 선택한 이유는 방대한 데이터셋에서 빠르게 이미지를 찾기위해 논문을 찾다가 알게 되었고,
저는 이 논문을 기반으로 짠 코드를 Never AI 해커톤에 나갔으며, 결승까지 가게 되었습니다.</p>

<p>이 논문을 기반으로 짠 코드가 궁금하시다면 <a href="https://github.com/KEJdev/mandoo-model">여기</a>를 클릭해주세요.<br />
다음에는 더 좋은 논문과 더 잘 요약된 포스팅글로 찾아뵐께요.</p>


                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/KEJdev">KEJdev</a></h4>
                                
                                    <p>If i was rich, I would eat tteokbokki every day.</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/KEJdev">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
                
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            
                
                
                
                
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/SQL-Grammar-1">
                <div class="post-card-image" style="background-image: url(/../assets/images/SQL_cover1.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/SQL-Grammar-1">
                <header class="post-card-header">
                    
                        
                            
                                <span class="post-card-tags">Sql</span>
                            
                        
                    

                    <h2 class="post-card-title">SQL 기본 문법</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <span class="post-card-author">
                            <a href="/author/KEJdev/">KEJdev</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header">
    <div class="floating-header-logo">
     
            
                <img src="/./assets/images/blog-icon.png" alt="덕복희 icon" />
            
            <span>덕복희</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Large-Scale Image Retrieval with Attentive Deep Local Features</div>
    
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>




        <!-- Previous/next page links - displayed on every page -->
        
        
        <script data-ad-client="ca-pub-5107584879184113" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-5107584879184113",
            enable_page_level_ads: true
          });
        </script>
        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <script data-ad-client="ca-pub-5107584879184113" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        </footer>

    </div>

    <!-- The big email subscribe modal content -->
    
        <div id="subscribe" class="subscribe-overlay">
            <a class="subscribe-overlay-close" href="#"></a>
            <div class="subscribe-overlay-content">
                
                    <img class="subscribe-overlay-logo" src="/./assets/images/blog-icon.png" alt="덕복희" />
                
            </div>
        </div>
    

    <!-- highlight.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-148043528-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        // show/hide floating header
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->

</body>
</html>
